import 'package:ep3/src/Article.dart';
import 'package:flutter_test/flutter_test.dart';
import 'package:http/http.dart' as http;
import 'dart:convert';

void main() {
  test("parses topstories.json", () {
    const jsonString =
        "[20976797,20976633,20976346,20974793,20974384,20974923,20975094,20976539,20974008,20976734,20948274,20948683,20960185,20974699,20976567,20970774,20974405,20972574,20972563,20965642,20972942,20974221,20961960,20974489,20975633,20950409,20973667,20972582,20949468,20973513,20974999,20949713,20972236,20973338,20976397,20950464,20971392,20976848,20972197,20973778,20963807,20972456,20975683,20961783,20972901,20959831,20974305,20973996,20971004,20959373,20966027,20972445,20971484,20971165,20974243,20949360,20962592,20973518,20976009,20975804,20971785,20975646,20970731,20973380,20965798,20949246,20964907,20970664,20973333,20971889,20948307,20966019,20973465,20975964,20971098,20948480,20964252,20965774,20965876,20962950,20962655,20961347,20969200,20965119,20959081,20959979,20965771,20968439,20959350,20970598,20968088,20948826,20955103,20969334,20974637,20960794,20965861,20958469,20961671,20960832,20958397,20951882,20962720,20963275,20954632,20959048,20969459,20967329,20963263,20957946,20974459,20962437,20948412,20959594,20970092,20963881,20975736,20974058,20960993,20974678,20961317,20958378,20958339,20972687,20968110,20970597,20962384,20970813,20975880,20962963,20959380,20959049,20956516,20960011,20975808,20963185,20961673,20950333,20963595,20950274,20973503,20964416,20966959,20948434,20949974,20958345,20966928,20966553,20971078,20962145,20960721,20958325,20965556,20963391,20961821,20968330,20954147,20954545,20950126,20948952,20963862,20957420,20966581,20949762,20966811,20963130,20974556,20974037,20949324,20965564,20970504,20965800,20952264,20950146,20973385,20959165,20965836,20972007,20969767,20971207,20967446,20953485,20962696,20966072,20963149,20948398,20952770,20963700,20948465,20958319,20975486,20958896,20973018,20958398,20965145,20974727,20957313,20950832,20971565,20953942,20952510,20957013,20974875,20948946,20960925,20970541,20955465,20960137,20973168,20956774,20959950,20970933,20974000,20954275,20951444,20956087,20958213,20952331,20974516,20971129,20969031,20965842,20951578,20963496,20954574,20955838,20963039,20949737,20952547,20950865,20956756,20954572,20956949,20956450,20949956,20974796,20962780,20956841,20950034,20952865,20964677,20964860,20963174,20956775,20954933,20970579,20970649,20968658,20968976,20973679,20974574,20967661,20952586,20965078,20951580,20951263,20969772,20974471,20948613,20954945,20952113,20968835,20951573,20973091,20958631,20953174,20965825,20965619,20972888,20961891,20952953,20972171,20961777,20972837,20953522,20951665,20965059,20968433,20974062,20974055,20970512,20949763,20964430,20968233,20953124,20959925,20963680,20973720,20963421,20951912,20950535,20963346,20961914,20955813,20962936,20953085,20973346,20970480,20973223,20954522,20953823,20952552,20965827,20953553,20972945,20950468,20972898,20960743,20950712,20972644,20962783,20955276,20964520,20968518,20954472,20956121,20968264,20955663,20963493,20963085,20962770,20974201,20961550,20970054,20971433,20954409,20962080,20968642,20971138,20952808,20970942,20960384,20968262,20968154,20966737,20954126,20959708,20970437,20962383,20952971,20954033,20958984,20953811,20965082,20966967,20969207,20958993,20959162,20965402,20966243,20958414,20954765,20961801,20958179,20950566,20971283,20965148,20950844,20968804,20949907,20968629,20967799,20964259,20956558,20956331,20966354,20969444,20955030,20954749,20962794,20969283,20952000,20956778,20957902,20963905,20951108,20961165,20964373,20966760,20964567,20962735,20959313,20965319,20957314,20961365,20962422,20969633,20968205,20963847,20967991,20963648,20960674,20955292,20963125,20956711,20958544,20948737,20955341,20966295,20966194,20961323,20965966,20965551,20965425,20965218,20956169,20964802,20961757,20958406,20969288,20954834,20964221,20964152,20963808,20949878,20957701,20956394,20957578,20963262,20956705,20959395,20971440,20950908,20955691,20948788,20948519,20970559,20951079,20959633,20956137,20959820,20966923,20955447,20954917,20957383,20953632,20952662,20952435,20949363,20958530,20958007,20949766,20956885,20949051,20956204,20956200,20955655,20955634,20955438,20955405,20967091,20954600,20954569,20954342,20952444,20951629,20951571,20953159,20958480,20961870,20950032,20948308,20950143,20951962,20959435,20964900,20948678,20952764,20951619,20972878]";
    expect(parseTopStories(jsonString).first, 20976797);
  });

  test("parses topstories.json", () {
    const jsonString =
        """{"by":"dhouston","descendants":71,"id":8863,"kids":[9224,8917,8952,8884,8887,8869,8958,8940,8908,9005,8873,9671,9067,9055,8865,8881,8872,8955,10403,8903,8928,9125,8998,8901,8902,8907,8894,8870,8878,8980,8934,8943,8876],"score":104,"time":1175714200,"title":"My YC app: Dropbox - Throw away your USB drive","type":"story","url":"http://www.getdropbox.com/u/2/screencast.html"}""";
    expect(parseArticle(jsonString).by, "dhouston");
  });

  test("parses topstories.json over a network", () async {
    final url = "https://hacker-news.firebaseio.com/v0/beststories.json";
    final res = await http.get(url);

    if (res.statusCode == 200) {
      final idList = json.decode(res.body);
      if (idList.isNotEmpty) {
        final storyUrl =
            'https://hacker-news.firebaseio.com/v0/item/${idList.first}.json';
        final storyRes = await http.get(storyUrl);
        if (res.statusCode == 200) {
          expect(parseArticle(storyRes.body), isNotNull);
        }
      }
    }
  }, skip: true);
}
